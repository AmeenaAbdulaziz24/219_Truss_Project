% FEM Sample Truss

% Clear Command Window and Workspace
clear all, clc;

% Knowns
mass = 1; % Mass hanging from the bridge in kg
P = (mass*9.81); %Converting the mass into a Force in kN
E = 10.932; % Modulus of Elasticity in GPa
A = 1; % Cross Section of the Truss (Rod) -- this is constant based on the 
%geometry of %the single trusses used (should all be constant cross sections)
l = [0.54; 0.6; 0.78; 1.2; 0.78; 1.2; 0.78; 1.2; 0.78; 1.2; 0.78]; 
%L array is hand calculated befrore simulation.  
% geometry of the truss
L = 25.4*l; %converting the array of centimeters into mm from inches
theata = [90; 0; 140; 0; 39.8; 0; 140; 0; 39.8; 0; 140;]; 
%theata array is hand calculated befrore simulation.
%measured from the horizontal

% K coeffients, from simplifying Hooke's law -- .* is an element-wise
% multiplication, this produces as matrix k that is 3 elements (the size of
% L)
k = E.*A./L;

% Generate K Matricies for each truss
% General K matrix
C = cosd(theata);
S = sind(theata);
CS = C.*S; %".*" is a known function in matlab which multiplies matrix C and S element by element and returns the result in CS

%Calculating the stiffness matrix for member 1 (14 x 14) 
k1 = k(1) * [C(1)^2, CS(1), -C(1)^2, -CS(1), 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             CS(1), S(1)^2, -CS(1), -S(1)^2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             -C(1)^2, -CS(1), C(1)^2, CS(1), 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             -CS(1), -S(1)^2, CS(1), S(1)^2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
         
% Calculating the local stiffness matrix for member 2
k2 = k(2) * [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
             0, 0, C(3)^2, CS(3), -C(3)^2, -CS(3), 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, CS(3), S(3)^2, -CS(3), -S(3)^2, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, -C(3)^2, -CS(3), C(3)^2, CS(3), 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, -CS(3), -S(3)^2, CS(3), S(3)^2, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];

% Calculating the local stiffness matrix for member 3
k3 = k(3) * [C(3)^2, CS(3), 0, 0, -C(3)^2, -CS(3), 0, 0, 0, 0, 0, 0, 0, 0;
              CS(3), S(3)^2, 0, 0, -CS(3), -S(3)^2, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             -C(3)^2, -CS(3), 0, 0, C(3)^2, CS(3), 0, 0, 0, 0, 0, 0, 0, 0;
             -CS(3), -S(3)^2, 0, 0, CS(3), S(3)^2, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
             
% Calculating the local stiffness matrix for member 4
k4 = k(4) * [C(4)^2, CS(4), 0, 0, 0, 0, -C(4)^2, -CS(4), 0, 0, 0, 0, 0, 0;
            CS(4), S(4)^2 0, 0, 0, 0, -CS(4), -S(4)^2, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             -C(4)^2, -CS(4), 0, 0, 0, 0, C(4)^2, CS(4), 0, 0, 0, 0, 0, 0;
             -CS(4), -S(4)^2, 0, 0, 0, 0, CS(4), S(4)^2,  0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
     
            
% Calculating the local stiffness matrix for member 5
k5 = k(5) * [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, C(5)^2, CS(5), -C(5)^2, -CS(5), 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, CS(5), S(5)^2, -CS(5), -S(5)^2, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, -C(5)^2, -CS(5), C(5)^2, CS(5), 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, -CS(5), -S(5)^2, CS(5), S(5)^2, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];

% Calculating the local stiffness matrix for member 6
k6 = k(6) * [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, C(6)^2, CS(6), 0, 0, -C(6)^2, -CS(6), 0, 0, 0, 0;
             0, 0, 0, 0, CS(6), S(6)^2, 0, 0, -CS(6), -S(6)^2, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, -C(6)^2, -CS(6), 0, 0, C(6)^2, CS(6), 0, 0, 0, 0;
             0, 0, 0, 0, -CS(6), -S(6)^2, 0, 0, CS(6), S(6)^2, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];

% Calculating the local stiffness matrix for member 7
k7 = k(7) * [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, C(7)^2, CS(7), -C(7)^2, -CS(7), 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, CS(7), S(7)^2, -CS(7), -S(7)^2, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, -C(7)^2, -CS(7), C(7)^2, CS(7), 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, -CS(7), -S(7)^2, CS(7), S(7)^2,  0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
         
% Calculating the local stiffness matrix for member 8
k8 = k(8) * [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, C(8)^2, CS(8), 0, 0, -C(8)^2, -CS(8), 0, 0;
             0, 0, 0, 0, 0, 0, CS(8), S(8)^2, 0, 0, -CS(8), -S(8)^2, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, -C(8)^2, -CS(8), 0, 0, C(8)^2, CS(8), 0, 0;
             0, 0, 0, 0, 0, 0, -CS(8), -S(8)^2, 0, 0, CS(8), S(8)^2, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
         
 
% Calculating the local stiffness matrix for member 9
k9 = k(9) * [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, C(9)^2, CS(9), -C(9)^2, -CS(9), 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, CS(9), S(9)^2, -CS(9), -S(9)^2, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, -C(9)^2, -CS(9), C(9)^2, CS(9), 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, -CS(9), -S(9)^2, CS(9), S(9)^2, 0, 0];

% Calculating the local stiffness matrix for member 10
k10 = k(10) * [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, C(10)^2, CS(10), 0, 0, -C(10)^2, -CS(10);
             0, 0, 0, 0, 0, 0, 0, 0, CS(10), S(10)^2, 0, 0, -CS(10), -S(10)^2;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, -C(10)^2, -CS(10), 0, 0, C(10)^2, CS(10);
             0, 0, 0, 0, 0, 0, 0, 0, -CS(10), -S(10)^2, 0, 0, CS(10), S(10)^2];

% Calculating the local stiffness matrix for member 11
k11 = k(11) * [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, C(11)^2, CS(11), -C(11)^2, -CS(11);
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, CS(11), S(11)^2, -CS(11), -S(11)^2;
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -C(11)^2, -CS(11), C(11)^2, CS(11);
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -CS(11), -S(11)^2, CS(11), S(11)^2];
                
%assembling the global stiffness matrix (of all the memebers)
K = k1 + k2 + k3 + k4 + k5 + k6 + k7 + k8 + k9 + k10 + k11;

% Solve for unknown displacements and create the displacement matrix 
%U = K \ [ 0; 0; 0; 0; 0; 0; 0; 0; 0; 0; 0; 0; 0; 0; 0; 0; 0; 0; 0; P];
% Solve for unknown displacements & create displacement matrix
% U = [K(3,3), K(3,5:6); K(5,3), K(5,5:6); K(6,3), K(6,5:6)] 
u = [K(4,4:14); K(5,4:14); K(6,4:14); K(7,4:14); K(8,4:14); K(9,4:14); 
     K(10,4:14); K(11,4:14); K(12,4:14); K(13,4:14); K(14,4:14)]\[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, P];

% Solve reation forces -- matricies
%F = K * U;

% Solve member forces
% fe1 = k(1) * ((U(3)-U(1))*C(1) + (U(4)-U(2))*S(1));
% fe2 = k(2) * ((U(5)-U(3))*C(2) + (U(6)-U(4))*S(2));
% fe3 = k(3) * ((U(5)-U(2))*C(3) + (U(6)-U(1))*S(3));

% Fe = [fe1;fe2;fe3];

% Format and print results
% fprintf('Nodal Displacements:\n');
% j = 1;
% for i = 1:2:length(U)
%     fprintf('u%ix = %.3f P/EA\n', j, U(i));
%     fprintf('u%iy = %.3f P/EA\n', j, U(i+1));
%     j = j+1;
% end

% fprintf('\nNodal Forces:\n');
% j = 1;
% for i = 1:2:length(F)
%     fprintf('f%ix = %.3f P\n', j, F(i));
%     fprintf('f%iy = %.3f P\n', j, F(i+1));
%     j = j+1;
% end

% fprintf('\nMember Forces:\n');
% for i = 1:length(Fe)
%     fprintf('f(%i) = %.3f P\n', i, Fe(i));
% end

%{  stiffness matrix template
% Calculating the local stiffness matrix for member z
% kz = k(z) * [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
%              0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
%              0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
%              0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
%              0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
%              0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
%              0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
%              0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
%              0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
%              0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
%              0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
%              0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
%              0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
%              0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
%              0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
%              0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
%              0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
%              0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
%              0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
%              0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
%              
%              C(z)^2, CS(z), -C(z)^2, -CS(z),
%              CS(z), S(z)^2, -CS(z), -S(z)^2,
%              -C(z)^2, -CS(z), C(z)^2, CS(z),
%              -CS(z), -S(z)^2, CS(z), S(z)^2, 
%              
%                 C(z)^2, CS(z), 0, 0, -C(z)^2, -CS(z),
%              CS(z), S(z)^2, 0, 0, -CS(z), -S(z)^2,
%              -C(z)^2, -CS(z), 0, 0, C(z)^2, CS(z),
%              -CS(z), -S(z)^2, 0, 0, CS(z), S(z)^2, 
